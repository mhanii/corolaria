# Docker Compose for Coloraria API (Production)
# Code baked in - connects to external infrastructure network
#
# Prerequisites: 
#   docker compose -f docker-compose.infrastructure.yml up -d
#
# Usage:
#   docker compose -f docker-compose.api.prod.yml up -d

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile.api
    image: coloraria-api:latest
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      # Database (MariaDB via infrastructure network)
      DATABASE_TYPE: ${DATABASE_TYPE:-mariadb}
      MARIADB_URI: mysql+pymysql://coloraria_user:${MARIADB_PASSWORD}@${MARIADB_HOST:-mariadb}:3306/coloraria

      # Neo4j connection
      NEO4J_URI: neo4j://${NEO4J_HOST:-neo4j}:7687
      NEO4J_USER: neo4j
      NEO4J_PASSWORD: ${NEO4J_PASSWORD}

      # Google AI
      GOOGLE_API_KEY: ${GOOGLE_API_KEY}

      # Observability (Phoenix on infrastructure network)
      PHOENIX_ENABLED: ${PHOENIX_ENABLED:-true}
      PHOENIX_ENDPOINT: ${PHOENIX_ENDPOINT:-http://phoenix:6006}

    volumes:
      # Bind mount for shared data
      - ${SHARED_DATA_PATH:-./data}:/app/data
    networks:
      - coloraria

networks:
  coloraria:
    name: coloraria_network
    external: true
